<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="PersonalPlan">
	<typeAlias alias="PersonalPlan" type="fitfame.po.PersonalPlan" />

	<select id="getPersonalPlanList" resultClass="PersonalPlan">
		select * from personal_plan where uid = #value#
	</select>
	
	<select id="getPersonalPlan" resultClass="PersonalPlan">
		select * from personal_plan where id = #value#
	</select>
	
	<select id="getUndoPersonalPlan" resultClass="PersonalPlan">
		select * from personal_plan where uid = #value# and edate = 0
	</select>

	<select id="getDonePersonalPlan" parameterClass="java.util.Map" resultClass="PersonalPlan">
	<![CDATA[ 
		select * from personal_plan where uid = #uid# and edate != 0 and edate < #edate#  order by edate desc limit 1
		 ]]> 
	</select>
	
	<insert id="insertPersonalPlan" parameterClass="PersonalPlan">
		insert into personal_plan values (null, #uid#, #pid#, #sdate#, #edate#)
		<selectKey resultClass="long" type="post" keyProperty="id">
			select LAST_INSERT_ID() as value
		</selectKey>
	</insert>

	<delete id="deletePersonalPlan">
		delete from personal_plan where id = #value#
	</delete>

	<update id="updatePersonalPlan" parameterClass="PersonalPlan">
		update personal_plan
		<dynamic prepend="SET ">
			<isNotEqual property="sdate" compareValue="-1" prepend=","><![CDATA[ sdate=#sdate# ]]></isNotEqual>
			<isNotEqual property="edate" compareValue="-1" prepend=","><![CDATA[ edate=#edate# ]]></isNotEqual>
		</dynamic>
		<dynamic prepend="WHERE">
			id = #id#
		</dynamic>
	</update>
</sqlMap>